<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tips on Big Data</title>
  <meta name="description" content="Eric Dolores Contents" />
  <meta name="author" content="Eric Dolores" />
  <link rel="icon" type="image/png" href="img/style/favicon-32x32.png"> 
  <script src="https://kit.fontawesome.com/c12878d3ba.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/sub_style.css">
  <script defer src="js/main.js"></script>
  <script defer src="js/pre_copy.js"></script>
</head>
<body>

 <header id="header">
    <div class="inner">
      <h1><a href="index.html">Eric Dolores</a></h1>
      <nav class="menuWeb">
        <ul id="gnb">
          <li><a href="research.html">Research</a></li>
           <li><a href="talks.html">Talks</a>
            <div class="sub_menu1">
              <ul>
                <li><a href="talks.html">Talks</a></li>  
                <li><a href="workshop_orgarnized.html">Workshop Orgarnized</a></li>
              </ul>
            </div>
           </li>
          <li><a href="experiments.html" class="active">Experiments with Technology</a>
            <div class="sub_menu1">
              <ul>
                <li><a href="experiments.html">Experiments with Technology</a></li>  
                <li><a href="tipson_bigdata.html">Tips on Big Data</a></li>          
              </ul>
            </div>
          </li>
          <li><a href="activism.html">Activism</a>
            <div class="sub_menu1">
              <ul>
                <li><a href="activism.html">Activism</a></li>  
                <li><a href="automation.html">Short Story</a></li>  
                <li><a href="timewar.html">Inheritance Acknowledgement</a></li> 
                <li><a href="books_movies.html">Books and Movies</a></li>          
              </ul>
            </div>
          </li>
          <li><a href="recursos.html">Recursos en español</a></li>      
        </ul>
      </nav>
      <a href="#" class="btnCall">
        <span>menu call</span>
      </a>
      <nav class="menuMo">
        <h1>
          <a href="index.html">Eric Dolores</a>
          <span>Researcher &#47; Activism</span>
        </h1>
        <ul id="gnbMo">
          <li><a href="research.html"> <i class="fa-solid fa-school"></i>Research</a></li>
          <li><a href="talks.html"> <i class="fa-solid fa-people-arrows"> </i>Talks</a>
            <div class="sub_menuMo">
              <ul>
                <li><a href="talks.html">Talks</a></li>  
                <li><a href="workshop_orgarnized.html">Workshop Orgarnized</a></li>           
              </ul>
            </div>
          </li>
          <li><a href="experiments.html"> <i class="fa-solid fa-vial"></i>Experiments with Technology</a>
            <div class="sub_menuMo">
              <ul>
                <li><a href="experiments.html">Experiments with Technology</a></li>  
                <li><a href="tipson_bigdata.html">Tips On Big Data</a></li>           
              </ul>
            </div>
          </li>
          <li><a href="activism.html"> <i class="fa-solid fa-dumbbell"></i>Activism</a>
            <div class="sub_menuMo">
              <ul>
                <li><a href="activism.html">Activism</a></li> 
                <li><a href="automation.html">Short Story</a></li> 
                <li><a href="timewar.html">Inheritance Acknowledgement</a></li>  
                <li><a href="books_movies.html">Books and Movies</a></li>           
              </ul>
            </div>
          </li>
          <li><a href="recursos.html"><i class="fa-solid fa-globe"></i>Recursos en español</a></li>
        </ul>
        
      </nav>
    </div>
  </header>

  <section class="content experiments">
    <div class="sub_visual"></div>
    <div class="inner">
      <ul class="breadcrumb">
        <li><a href="index.html"><i class="fa-sharp fa-solid fa-house"></i></a></li>
        <li class="on"><a href="tipson_bigdata.html">Tips on Big Data</a></li>
      </ul>
      <h1>Tips on Big Data (images)</h1>
      <div class="conts">
        <section class="tipson_bigdata">
          <h2>Advices to run computations on big image data</h2> 
          <span><img src="img/works/eagle.jpg" alt="">
          <img src="img/works/eagle2.jpg" alt=""></span>
          <strong>Animations of Yonsei's Eagle Statue generated by a <a href="https://hanlab.mit.edu/projects/diffaug" target="_blank">GAN algorithm.</a></strong>
          
          <div>
             <p class="soruce_txt">Most python tutorials explain that if you need to create a list, <a href="https://peps.python.org/pep-0202/" target="_blank">list comprehensions</a> are faster than for loops.</p>
             <p class="code_box">
               <button id="button1" class="btns_copy">copy</button>
               <pre id="pre1">
                import timeit

                s='''iterations = 100
                newlist = []
                for i in range(iterations):
                <code>newlist.append(i+1)'''</code>
                timeit.timeit(s)
                8.76447730000001
               </pre>
             </p>
      
             Compared with
             <p class="code_box">
              <button id="button2" class="btns_copy">copy</button>
                <pre id="pre2">
                s2='''iterations = 100
                newlist = [i+1 for i in range(iterations)]'''
                timeit.timeit(s2)
                4.8245505000000435
                </pre>
              </p>
   
             Now, assume that the objects on the list are all possible combinations of two processes on images <br />(perhaps this is a grid search for optimal parameters). Let's say

             <p class="code_box">
              <button id="button3" class="btns_copy">copy</button>
             <pre id="pre3">
               def P(X,a):
               <code>#X is the image</code>
               <code>#a is a parameter to test</code>

               def Q(Y,b):
               <code>#Y is the output of P(X,a)</code>
               <code>#b is a parameter to test</code>
                
               X = some image
               values = [Q(P(X,a),b) for a in P_parameters for b in Q_parameters]
             </pre>
            </p>
 
             Note that you compute 'P(X,a)' several times.<br /> You may assume that the speed improvement of the list comprehension is worth repeating a computation, but in the following example,<br /> we see that there is not even a speed improvement:

             <p class="code_box">
             <button id="button4" class="btns_copy">copy</button>
             <pre id="pre4">
              import timeit
              s='''
              from PIL import Image
              img = Image.effect_noise((128,128), 64)
              base_img = Image.effect_noise((128,128), 32)
              base2_img = Image.effect_noise((128,128), 128)
              listimages=[]
              for value in range(100):
              <code>imgt = Image.blend(img, base_img, value/110)
              <code>for value2 in range(100):
                      <code style="padding-left:40px;">endvalue = Image.blend(imgt, base2_img, value2/110)
                      <code style="padding-left:40px;">listimages.append(endvalue)
              '''

              s2='''
              from PIL import Image
              img = Image.effect_noise((128,128), 64)
              base_img = Image.effect_noise((128,128), 32)
              base2_img = Image.effect_noise((128,128), 128)
              otherlist = [Image.blend(Image.blend(img, base_img, value/110), base2_img, value2/110) for value in range(100) for value2 in range(100) ]'''

              timeit.timeit(stmt=s, number=10)
              3.420247700000118

              timeit.timeit(stmt=s2, number=10)
              5.474881500000038
             </pre>
            </p>

             <p>This is an abstract example, but in Machine Learning/Computer Vision you may have a similar process with other operations such as rotation or resizing.</p>
             <p>
             Here is another example of optimization, this one is <a href="https://wiki.python.org/moin/PythonSpeed/PerformanceTips" target="_blank">from Python Performance tips.</a></p>

             <p class="code_box">
              <button id="button5" class="btns_copy">copy</button>
               <pre id="pre5">
                 newlist = []
                 for word in oldlist:
                 <code>newlist.append(word.upper())</code>
               </pre>
             </p>

              <p>"Suppose you can't use map or a list comprehension? You may be stuck with the for loop. <br />The for loop example has another inefficiency. Both newlist.append and word.upper are function references that are reevaluated each time through the loop."</p>
            
             <p>you should write instead:</p>

            <p class="code_box">
              <button id="button6" class="btns_copy">copy</button>
              <pre id="pre6">
                upper = str.upper
                newlist = []
                append = newlist.append
                for word in oldlist:
                <code>append(upper(word))</code>
              </pre>
            </p>

            <p><a href="https://wiki.python.org/moin/PythonSpeed/PerformanceTips"  target="_blank">The list of Performance tips</a> also recommends using local variables:</p>
            <p>
            "If the above loop is cast as a function, append and upper become local variables. Python accesses local variables much more efficiently than global variables." 
            <br />So the version with local variables is</p>

            <p class="code_box">
              <button id="button7" class="btns_copy">copy</button>
              <pre id="pre7">
                def func(oldlist):
                <code>upper = str.upper</code>
                <code>newlist = []</code>
                <code>append = newlist.append</code>
                <code>for word in oldlist:</code>
                    <code style="padding-left:40px;">append(upper(word))</code>
                    <code>return newlist</code>
    
              </pre>
            </p>
            <p>but in my computer that didn't improve the speed.</p>
            <p>I received some emails questioning the validity of those optimizations.</p>
            <p>First of all, the author of the Python performance tips suggest that we should always make test with our specific version of Python. <br />I compared the previous blocks of code in my laptop, by plotting the number of words in oldlist vs time. Here are my results:</p>
            <span><img src="img/style/final.jpg" alt=""></span>
            <p>In this case, avoiding dots seems to be a good idea when working with big data, but you should make your own test.</p>
            Another piece of advice is to learn about Threads and Multiprocess. Sometimes a simple:


            <p class="code_box">
              <button id="button8" class="btns_copy">copy</button>
              <pre id="pre8">
                import threading
                import concurrent.futures

                n=#virtual cpus

                with concurrent.futures.ProcessPoolExecutor(max_workers=n) as executor:
                    <code>executor.map(your_function, some_list_of_inputs) </code>
              </pre>
            </p>
            <p>will suffice.<br />
            You can find other advices, such as profiling, in <a href="https://wiki.python.org/moin/PythonSpeed/PerformanceTips" target="_blank">this link of Performance tips.</a></p>
          </div>
        </section>

      </div>
    </div>
  </section>


  <footer id="footer"><!-- #footer_sub -->
    <div class="inner">
      <h1>Eric Dolores</h1>
      <p>Copyright &copy; 2024 Eric Dolores ALL Right reserved.</p>
      <div class="visitors">
        <script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=5ebyaoz5gzt&amp;m=7&amp;c=ff0000&amp;cr1=ffffff&amp;f=ubuntu&amp;l=17" async="async"></script>
      </div>
    </div>   
    <p class="btns_main">
      <button onclick="window.scrollTo(0, 0);" class="top_button">
        <i class="fas fa-chevron-up"></i>
      </button>
      <button type="button" class="copy_button" onclick="copyUrl()"><i class="fa-solid fa-share-from-square"></i></button>
    </p>
  </footer>

</body>

</html>